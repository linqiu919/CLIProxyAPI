## CLIProxyAPI

> 项目描述：为 CLI 工具提供 OpenAI/Gemini/Claude/Codex 兼容的代理 API，并内置管理后台。
>
> 项目目的：统一多供应商/多账号接入与管理，提供 OAuth 登录、路由与统计能力。
>
> 项目状态：活跃维护中（开源社区）。
>
> 项目团队：router-for-me 与社区贡献者。
>
> 关键技术：Go 1.24 + Gin；React 19 + Vite + TypeScript；Zustand 状态管理；管理 UI 内嵌到后端静态资源。


## Notes
- 管理端 `/v0/management/api-call` 在请求失败返回 502 时会增加 `detail` 字段携带底层错误信息。
- Quota 管理页按页/全部切换为单个文字按钮并按配置持久化，默认每页 14 条。
- Quota 管理页文件名模糊化切换按钮不再依赖按页模式，始终可见且状态持久化。
- Quota 管理页支持网格/列表视图切换并持久化，列表视图为表格行样式（主题信息与配额同一行，左侧主题信息 + 右侧配额横排，模型/时间置于进度条上方），使用单个图标按钮切换。
- 认证文件页文件名模糊化开关与配额页一致做持久化。
- 文件名模糊化样式与眼睛按钮样式复用 AuthFilesPage 的交互语义，i18n 仍挂在 auth_files 命名空间。

## Dependencies (init from programming language specification like package.json, requirements.txt, etc.)

* go 1.24: 后端主语言与工具链
* github.com/gin-gonic/gin v1.10.1: HTTP 路由与中间件
* github.com/go-git/go-git/v6 v6.0.0: Git 访问与仓库操作
* github.com/jackc/pgx/v5 v5.7.4: PostgreSQL 驱动
* golang.org/x/oauth2 v0.30.0: OAuth 登录流程支持
* github.com/sirupsen/logrus v1.9.3: 日志
* react v19.2.1: 前端 UI
* react-router-dom v7.10.1: 前端路由
* zustand v5.0.9: 前端状态管理
* axios v1.13.2: HTTP 请求
* vite v7.2.6 / typescript v5.9.3: 前端构建与类型检查
* eslint v9.39.1 / prettier v3.7.4: 代码规范


## Development Environment

- Go 1.24+
- Node.js + npm（web/ 前端）
- Vite + TypeScript（dev/build/type-check）
- ESLint + Prettier（lint/format）
- Docker / Docker Compose（可选，用于容器化部署）


## Structrue (init from project tree)

> It is essential to consistently refine the analysis down to the file level — this level of granularity is of utmost importance.

> If the number of files is too large, you should at least list all the directories, and provide comments for the parts you consider particularly important.

> In the code block below, add comments to the directories/files to explain their functionality and usage scenarios.

> if you think the directory/file is not important, you can not skip it, just add a simple comment to it.

> but if you think the directory/file is important, you should read the files and add more detail comments on it (e.g. add comments on the functions, classes, and variables. explain the functionality and usage scenarios. write the importance of the directory/file).
```
root
- .dockerignore
- .github
    - FUNDING.yml
    - ISSUE_TEMPLATE
        - bug_report.md
    - workflows
        - docker-image.yml
- .gitignore
- .goreleaser.yml
- Dockerfile
- LICENSE
- README.md
- README_CN.md
- assets
    - cubence.png
    - packycode.png
- auths
    - .gitkeep
- cmd
    - server
        - main.go
- config.example.yaml
- docker-build.ps1
- docker-build.sh
- docker-compose.yml
- docs
- examples
    - custom-provider
        - main.go
    - http-request
        - main.go
    - translator
        - main.go
- go.mod
- go.sum
- internal
    - access
        - config_access
            - provider.go
        - reconcile.go
    - api
        - handlers
            - management
                - api_tools.go
                - api_tools_test.go
                - auth_files.go
                - config_basic.go
                - config_lists.go
                - handler.go
                - logs.go
                - oauth_callback.go
                - oauth_sessions.go
                - quota.go
                - usage.go
                - vertex_import.go
        - middleware
            - request_logging.go
            - response_writer.go
        - modules
            - amp
                - amp.go
                - amp_test.go
                - fallback_handlers.go
                - fallback_handlers_test.go
                - gemini_bridge.go
                - gemini_bridge_test.go
                - model_mapping.go
                - model_mapping_test.go
                - proxy.go
                - proxy_test.go
                - response_rewriter.go
                - routes.go
                - routes_test.go
                - secret.go
                - secret_test.go
            - modules.go
        - server.go
        - server_test.go
    - auth
        - claude
            - anthropic.go
            - anthropic_auth.go
            - errors.go
            - html_templates.go
            - oauth_server.go
            - pkce.go
            - token.go
        - codex
            - errors.go
            - filename.go
            - html_templates.go
            - jwt_parser.go
            - oauth_server.go
            - openai.go
            - openai_auth.go
            - pkce.go
            - token.go
        - empty
            - token.go
        - gemini
            - gemini_auth.go
            - gemini_token.go
        - iflow
            - cookie_helpers.go
            - iflow_auth.go
            - iflow_token.go
            - oauth_server.go
        - models.go
        - qwen
            - qwen_auth.go
            - qwen_token.go
        - vertex
            - keyutil.go
            - vertex_credentials.go
    - browser
        - browser.go
    - buildinfo
        - buildinfo.go
    - cache
        - signature_cache.go
        - signature_cache_test.go
    - cmd
        - anthropic_login.go
        - antigravity_login.go
        - auth_manager.go
        - iflow_cookie.go
        - iflow_login.go
        - login.go
        - openai_login.go
        - qwen_login.go
        - run.go
        - vertex_import.go
    - config
        - config.go
        - oauth_model_alias_migration.go
        - oauth_model_alias_migration_test.go
        - oauth_model_alias_test.go
        - sdk_config.go
        - vertex_compat.go
    - constant
        - constant.go
    - interfaces
        - api_handler.go
        - client_models.go
        - error_message.go
        - types.go
    - logging
        - gin_logger.go
        - gin_logger_test.go
        - global_logger.go
        - log_dir_cleaner.go
        - log_dir_cleaner_test.go
        - request_logger.go
        - requestid.go
    - managementasset
        - embed.go
        - static
            - .gitkeep
        - updater.go
    - misc
        - claude_code_instructions.go
        - claude_code_instructions.txt
        - codex_instructions
            - gpt-5.1-codex-max_prompt.md-001-d5dfba250975b4519fed9b8abf99bbd6c31e6f33
            - gpt-5.1-codex-max_prompt.md-002-e0fb3ca1dbea0c418cf8b3c7b76ed671d62147e3
            - gpt-5.2-codex_prompt.md-001-f084e5264b1b0ae9eb8c63c950c0953f40966fed
            - gpt_5_1_prompt.md-001-ec69a4a810504acb9ba1d1532f98f9db6149d660
            - gpt_5_1_prompt.md-002-8dcbd29edd5f204d47efa06560981cd089d21f7b
            - gpt_5_1_prompt.md-003-daf77b845230c35c325500ff73fe72a78f3b7416
            - gpt_5_1_prompt.md-004-e0fb3ca1dbea0c418cf8b3c7b76ed671d62147e3
            - gpt_5_2_prompt.md-001-238ce7dfad3916c325d9919a829ecd5ce60ef43a
            - gpt_5_codex_prompt.md-001-f037b2fd563856ebbac834ec716cbe0c582f25f4
            - gpt_5_codex_prompt.md-002-c9505488a120299b339814d73f57817ee79e114f
            - gpt_5_codex_prompt.md-003-f6a152848a09943089dcb9cb90de086e58008f2a
            - gpt_5_codex_prompt.md-004-5d78c1edd337c038a1207c30fe8a6fa329e3d502
            - gpt_5_codex_prompt.md-005-35c76ad47d0f6f134923026c9c80d1f2e9bbd83f
            - gpt_5_codex_prompt.md-006-0ad1b0782b16bb5e91065da622b7c605d7d512e6
            - gpt_5_codex_prompt.md-007-8c75ed39d5bb94159d21072d7384765d94a9012b
            - gpt_5_codex_prompt.md-008-daf77b845230c35c325500ff73fe72a78f3b7416
            - gpt_5_codex_prompt.md-009-e0fb3ca1dbea0c418cf8b3c7b76ed671d62147e3
            - prompt.md-001-31d0d7a305305ad557035a2edcab60b6be5018d8
            - prompt.md-002-6ce0a5875bbde55a00df054e7f0bceba681cf44d
            - prompt.md-003-a6139aa0035d19d794a3669d6196f9f32a8c8352
            - prompt.md-004-063083af157dcf57703462c07789c54695861dff
            - prompt.md-005-d31e149cb1b4439f47393115d7a85b3c8ab8c90d
            - prompt.md-006-81b148bda271615b37f7e04b3135e9d552df8111
            - prompt.md-007-90d892f4fd5ffaf35b3dacabacdd260d76039581
            - prompt.md-008-30ee24521b79cdebc8bae084385550d86db7142a
            - prompt.md-009-e4c275d615e6ba9dd0805fb2f4c73099201011a0
            - prompt.md-010-3d8bca7814824cab757a78d18cbdc93a40f1126f
            - prompt.md-011-4ae45a6c8df62287d720385430d0458a0b2dc354
            - prompt.md-012-bef7ed0ccc563e61fac5bef811c6079d9d65ce60
            - prompt.md-013-b1c291e2bbca0706ec9b2888f358646e65a8f315
            - review_prompt.md-001-90a0fd342f5dc678b63d2b27faff7ace46d4af51
            - review_prompt.md-002-f842849bec97326ad6fb40e9955b6ba9f0f3fc0d
        - codex_instructions.go
        - copy-example-config.go
        - credentials.go
        - gpt_5_codex_instructions.txt
        - gpt_5_instructions.txt
        - header_utils.go
        - mime-type.go
        - oauth.go
        - opencode_codex_instructions.txt
    - registry
        - model_definitions.go
        - model_registry.go
        - model_registry_hook_test.go
    - runtime
        - executor
            - aistudio_executor.go
            - antigravity_executor.go
            - cache_helpers.go
            - claude_executor.go
            - claude_executor_test.go
            - cloak_obfuscate.go
            - cloak_utils.go
            - codex_executor.go
            - gemini_cli_executor.go
            - gemini_executor.go
            - gemini_vertex_executor.go
            - iflow_executor.go
            - iflow_executor_test.go
            - logging_helpers.go
            - openai_compat_executor.go
            - payload_helpers.go
            - proxy_helpers.go
            - qwen_executor.go
            - qwen_executor_test.go
            - thinking_providers.go
            - token_helpers.go
            - usage_helpers.go
        - geminicli
            - state.go
    - store
        - gitstore.go
        - objectstore.go
        - postgresstore.go
    - thinking
        - apply.go
        - convert.go
        - errors.go
        - provider
            - antigravity
                - apply.go
            - claude
                - apply.go
            - codex
                - apply.go
            - gemini
                - apply.go
            - geminicli
                - apply.go
            - iflow
                - apply.go
            - openai
                - apply.go
        - strip.go
        - suffix.go
        - text.go
        - types.go
        - validate.go
    - translator
        - antigravity
            - claude
                - antigravity_claude_request.go
                - antigravity_claude_request_test.go
                - antigravity_claude_response.go
                - antigravity_claude_response_test.go
                - init.go
            - gemini
                - antigravity_gemini_request.go
                - antigravity_gemini_request_test.go
                - antigravity_gemini_response.go
                - init.go
            - openai
                - chat-completions
                    - antigravity_openai_request.go
                    - antigravity_openai_response.go
                    - init.go
                - responses
                    - antigravity_openai-responses_request.go
                    - antigravity_openai-responses_response.go
                    - init.go
        - claude
            - gemini
                - claude_gemini_request.go
                - claude_gemini_response.go
                - init.go
            - gemini-cli
                - claude_gemini-cli_request.go
                - claude_gemini-cli_response.go
                - init.go
            - openai
                - chat-completions
                    - claude_openai_request.go
                    - claude_openai_response.go
                    - init.go
                - responses
                    - claude_openai-responses_request.go
                    - claude_openai-responses_response.go
                    - init.go
        - codex
            - claude
                - codex_claude_request.go
                - codex_claude_response.go
                - init.go
            - gemini
                - codex_gemini_request.go
                - codex_gemini_response.go
                - init.go
            - gemini-cli
                - codex_gemini-cli_request.go
                - codex_gemini-cli_response.go
                - init.go
            - openai
                - chat-completions
                    - codex_openai_request.go
                    - codex_openai_response.go
                    - init.go
                - responses
                    - codex_openai-responses_request.go
                    - codex_openai-responses_response.go
                    - init.go
        - gemini
            - claude
                - gemini_claude_request.go
                - gemini_claude_response.go
                - init.go
            - common
                - safety.go
            - gemini
                - gemini_gemini_request.go
                - gemini_gemini_response.go
                - init.go
            - gemini-cli
                - gemini_gemini-cli_request.go
                - gemini_gemini-cli_response.go
                - init.go
            - openai
                - chat-completions
                    - gemini_openai_request.go
                    - gemini_openai_response.go
                    - init.go
                - responses
                    - gemini_openai-responses_request.go
                    - gemini_openai-responses_response.go
                    - gemini_openai-responses_response_test.go
                    - init.go
        - gemini-cli
            - claude
                - gemini-cli_claude_request.go
                - gemini-cli_claude_response.go
                - init.go
            - gemini
                - gemini-cli_gemini_request.go
                - gemini-cli_gemini_response.go
                - init.go
            - openai
                - chat-completions
                    - gemini-cli_openai_request.go
                    - gemini-cli_openai_response.go
                    - init.go
                - responses
                    - gemini-cli_openai-responses_request.go
                    - gemini-cli_openai-responses_response.go
                    - init.go
        - init.go
        - openai
            - claude
                - init.go
                - openai_claude_request.go
                - openai_claude_request_test.go
                - openai_claude_response.go
            - gemini
                - init.go
                - openai_gemini_request.go
                - openai_gemini_response.go
            - gemini-cli
                - init.go
                - openai_gemini_request.go
                - openai_gemini_response.go
            - openai
                - chat-completions
                    - init.go
                    - openai_openai_request.go
                    - openai_openai_response.go
                - responses
                    - init.go
                    - openai_openai-responses_request.go
                    - openai_openai-responses_response.go
        - translator
            - translator.go
    - usage
        - logger_plugin.go
    - util
        - claude_model.go
        - claude_model_test.go
        - gemini_schema.go
        - gemini_schema_test.go
        - header_helpers.go
        - image.go
        - provider.go
        - proxy.go
        - sanitize_test.go
        - ssh_helper.go
        - translator.go
        - util.go
    - watcher
        - clients.go
        - config_reload.go
        - diff
            - config_diff.go
            - config_diff_test.go
            - model_hash.go
            - model_hash_test.go
            - models_summary.go
            - oauth_excluded.go
            - oauth_excluded_test.go
            - oauth_model_alias.go
            - openai_compat.go
            - openai_compat_test.go
        - dispatcher.go
        - events.go
        - synthesizer
            - config.go
            - config_test.go
            - context.go
            - file.go
            - file_test.go
            - helpers.go
            - helpers_test.go
            - interface.go
        - watcher.go
        - watcher_test.go
    - wsrelay
        - http.go
        - manager.go
        - message.go
        - session.go
- sdk
    - access
        - errors.go
        - manager.go
        - registry.go
    - api
        - handlers
            - claude
                - code_handlers.go
            - gemini
                - gemini-cli_handlers.go
                - gemini_handlers.go
            - handlers.go
            - handlers_request_details_test.go
            - handlers_stream_bootstrap_test.go
            - openai
                - openai_handlers.go
                - openai_responses_handlers.go
            - stream_forwarder.go
        - management.go
        - options.go
    - auth
        - antigravity.go
        - claude.go
        - codex.go
        - errors.go
        - filestore.go
        - gemini.go
        - iflow.go
        - interfaces.go
        - manager.go
        - qwen.go
        - refresh_registry.go
        - store_registry.go
    - cliproxy
        - auth
            - api_key_model_alias_test.go
            - conductor.go
            - errors.go
            - oauth_model_alias.go
            - oauth_model_alias_test.go
            - selector.go
            - selector_test.go
            - status.go
            - store.go
            - types.go
        - builder.go
        - executor
            - types.go
        - model_registry.go
        - pipeline
            - context.go
        - providers.go
        - rtprovider.go
        - service.go
        - service_oauth_model_alias_test.go
        - types.go
        - usage
            - manager.go
        - watcher.go
    - config
        - config.go
    - logging
        - request_logger.go
    - translator
        - builtin
            - builtin.go
        - format.go
        - formats.go
        - helpers.go
        - pipeline.go
        - registry.go
        - types.go
- static
- test
    - amp_management_test.go
    - builtin_tools_translation_test.go
    - config_migration_test.go
    - thinking_conversion_test.go
- web
    - .eslintrc.cjs
    - .github
        - workflows
            - release.yml
    - .gitignore
    - .prettierrc
    - README.md
    - README_CN.md
    - eslint.config.js
    - index.html
    - logo.jpg
    - node_modules
    - package-lock.json
    - package.json
    - src
        - App.css
        - App.tsx
        - assets
            - icons
                - amp.svg
                - antigravity.svg
                - claude.svg
                - gemini.svg
                - iflow.svg
                - openai-dark.svg
                - openai-light.svg
                - qwen.svg
                - vertex.svg
            - logoInline.ts
            - react.svg
        - components
            - common
                - ConfirmationModal.tsx
                - NotificationContainer.tsx
                - PageTransition.scss
                - PageTransition.tsx
                - SplashScreen.scss
                - SplashScreen.tsx
            - layout
                - MainLayout.tsx
            - providers
                - AmpcodeSection
                    - AmpcodeModal.tsx
                    - AmpcodeSection.tsx
                    - index.ts
                - ClaudeSection
                    - ClaudeModal.tsx
                    - ClaudeSection.tsx
                    - index.ts
                - CodexSection
                    - CodexModal.tsx
                    - CodexSection.tsx
                    - index.ts
                - GeminiSection
                    - GeminiModal.tsx
                    - GeminiSection.tsx
                    - index.ts
                - OpenAISection
                    - OpenAIDiscoveryModal.tsx
                    - OpenAIModal.tsx
                    - OpenAISection.tsx
                    - index.ts
                - ProviderList.tsx
                - ProviderStatusBar.tsx
                - VertexSection
                    - VertexModal.tsx
                    - VertexSection.tsx
                    - index.ts
                - hooks
                    - useProviderStats.ts
                - index.ts
                - types.ts
                - utils.ts
            - quota
                - QuotaCard.tsx
                - QuotaSection.tsx
                - index.ts
                - quotaConfigs.ts
                - useGridColumns.ts
                - useQuotaLoader.ts
            - ui
                - Button.tsx
                - Card.tsx
                - EmptyState.tsx
                - HeaderInputList.tsx
                - Input.tsx
                - LoadingSpinner.tsx
                - Modal.tsx
                - ModelInputList.tsx
                - ToggleSwitch.tsx
                - icons.tsx
            - usage
                - ApiDetailsCard.tsx
                - ChartLineSelector.tsx
                - ModelStatsCard.tsx
                - PriceSettingsCard.tsx
                - StatCards.tsx
                - UsageChart.tsx
                - hooks
                    - index.ts
                    - useChartData.ts
                    - useSparklines.ts
                    - useUsageData.ts
                - index.ts
        - hooks
            - index.ts
            - useApi.ts
            - useDebounce.ts
            - useHeaderRefresh.ts
            - useInterval.ts
            - useLocalStorage.ts
            - useMediaQuery.ts
            - usePagination.ts
        - i18n
            - index.ts
            - locales
                - en.json
                - zh-CN.json
        - index.css
        - main.tsx
        - pages
            - AiProvidersPage.module.scss
            - AiProvidersPage.tsx
            - ApiKeysPage.module.scss
            - ApiKeysPage.tsx
            - AuthFilesPage.module.scss
            - AuthFilesPage.tsx
            - ConfigPage.module.scss
            - ConfigPage.tsx
            - DashboardPage.module.scss
            - DashboardPage.tsx
            - Login
                - Login.module.scss
            - LoginPage.tsx
            - LogsPage.module.scss
            - LogsPage.tsx
            - OAuthPage.module.scss
            - OAuthPage.tsx
            - PlaceholderPage.module.scss
            - PlaceholderPage.tsx
            - QuotaPage.module.scss
            - QuotaPage.tsx
            - Settings
                - Settings.module.scss
            - SettingsPage.tsx
            - SystemPage.module.scss
            - SystemPage.tsx
            - UsagePage.module.scss
            - UsagePage.tsx
        - router
            - MainRoutes.tsx
            - ProtectedRoute.tsx
        - services
            - api
                - ampcode.ts
                - apiCall.ts
                - apiKeys.ts
                - authFiles.ts
                - client.ts
                - config.ts
                - configFile.ts
                - index.ts
                - logs.ts
                - models.ts
                - oauth.ts
                - providers.ts
                - transformers.ts
                - usage.ts
                - version.ts
                - vertex.ts
            - storage
                - secureStorage.ts
        - stores
            - index.ts
            - useAuthStore.ts
            - useConfigStore.ts
            - useLanguageStore.ts
            - useModelsStore.ts
            - useNotificationStore.ts
            - useQuotaStore.ts
            - useThemeStore.ts
        - styles
            - components.scss
            - global.scss
            - layout.scss
            - mixins.scss
            - reset.scss
            - themes.scss
            - variables.scss
        - types
            - ampcode.ts
            - api.ts
            - auth.ts
            - authFile.ts
            - common.ts
            - config.ts
            - index.ts
            - log.ts
            - oauth.ts
            - provider.ts
            - quota.ts
            - style.d.ts
            - usage.ts
        - utils
            - connection.ts
            - constants.ts
            - encryption.ts
            - format.ts
            - headers.ts
            - helpers.ts
            - language.ts
            - models.ts
            - quota
                - builders.ts
                - constants.ts
                - formatters.ts
                - index.ts
                - parsers.ts
                - resolvers.ts
                - validators.ts
            - usage
                - chartConfig.ts
                - index.ts
            - usage.ts
            - validation.ts
        - vite-env.d.ts
    - tsconfig.app.json
    - tsconfig.json
    - tsconfig.node.json
    - vite.config.ts
```
